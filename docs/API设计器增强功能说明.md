# API设计器增强功能说明

## 新增功能概览

API设计器已增强，现在支持类似Apifox的智能功能：

### ✅ 1. 环境配置功能

**功能说明：**
- 支持多个环境配置（开发、测试、生产等）
- 每个环境可以配置独立的基础URL
- 快速切换环境进行API测试

**使用方法：**
1. 点击右上角的"环境"按钮，打开环境配置弹窗
2. 选择要配置的环境（开发/测试/生产）
3. 配置环境名称、基础URL和描述
4. 保存配置

**环境切换：**
- 在API列表右上角有环境选择下拉框
- 在接口测试的"请求地址"输入框前也有环境选择
- 切换环境后，相对路径会自动拼接当前环境的基础URL

**默认环境：**
- 开发环境：`http://localhost:3001`
- 测试环境：`https://test-api.example.com`
- 生产环境：`https://api.example.com`

---

### ✅ 2. API搜索功能

**功能说明：**
- 支持按名称、路径、方法、描述进行搜索
- 实时过滤API列表
- 支持清空搜索

**使用方法：**
- 在API列表上方有搜索框
- 输入关键词即可实时过滤
- 点击清空按钮清除搜索条件

**搜索范围：**
- API名称
- API路径
- HTTP方法（GET、POST等）
- API描述

---

### ✅ 3. JSON格式化功能

**功能说明：**
- 自动格式化JSON字符串
- 美化显示，提高可读性
- 支持多处使用

**使用位置：**
1. **请求体（JSON）输入框**
   - 点击"格式化"按钮自动格式化JSON
   - 点击"复制"按钮复制JSON到剪贴板

2. **请求体示例标签页**
   - 点击"格式化"按钮格式化JSON

3. **Mock响应标签页**
   - 点击"格式化"按钮格式化JSON

4. **测试结果**
   - 点击"格式化"按钮美化显示结果
   - 点击"复制"按钮复制结果到剪贴板

**格式化规则：**
- 自动缩进（2个空格）
- 自动换行
- 保持JSON格式正确性

---

### ✅ 4. Mock响应配置说明

#### Mock响应的目的

**为什么需要Mock响应？**

1. **前端开发独立**
   - 无需等待后端接口完成
   - 前端可以独立开发和测试
   - 前后端并行开发，提高效率

2. **快速迭代**
   - 可以快速验证前端功能
   - 无需等待后端部署
   - 提高开发效率

3. **数据模拟**
   - 模拟各种数据场景
   - 成功、失败、边界情况
   - 异常数据处理

4. **离线开发**
   - 即使后端服务不可用，也能继续开发
   - 不依赖网络环境
   - 本地开发更稳定

5. **测试场景**
   - 模拟不同响应状态
   - 测试错误处理逻辑
   - 验证UI展示效果

#### Mock响应是否必要？

**答案：视情况而定**

**必须配置Mock响应的场景：**
- ✅ API路径是相对路径（如 `/api/users`）
- ✅ 后端接口尚未开发完成
- ✅ 需要离线开发
- ✅ 需要模拟特定数据场景

**可以不配置Mock响应的场景：**
- ✅ API路径是完整URL（如 `https://api.example.com/users`）
- ✅ 后端接口已开发完成且可用
- ✅ 需要测试真实接口

**使用规则：**
1. **相对路径 + 有Mock响应** → 使用Mock响应
2. **相对路径 + 无Mock响应 + 有环境基础URL** → 发送真实请求
3. **完整URL** → 发送真实请求（忽略Mock响应）

---

## 功能对比

| 功能 | 之前 | 现在 |
|------|------|------|
| 环境配置 | ❌ 不支持 | ✅ 支持多环境配置和切换 |
| API搜索 | ❌ 不支持 | ✅ 支持多字段搜索 |
| JSON格式化 | ❌ 手动格式化 | ✅ 一键格式化 |
| Mock说明 | ⚠️ 不明确 | ✅ 详细说明和提示 |
| 测试结果 | ⚠️ 基础显示 | ✅ 美化显示，支持复制 |

---

## 使用示例

### 示例1：配置开发环境

1. 点击"环境"按钮
2. 选择"开发环境"
3. 设置基础URL：`http://localhost:3001`
4. 保存

### 示例2：搜索API

1. 在搜索框输入"用户"
2. 自动过滤出包含"用户"的API
3. 可以按路径搜索：输入"/api"
4. 可以按方法搜索：输入"GET"

### 示例3：格式化JSON

1. 在请求体输入框输入：`{"name":"Tom","age":18}`
2. 点击"格式化"按钮
3. 自动格式化为：
   ```json
   {
     "name": "Tom",
     "age": 18
   }
   ```

### 示例4：使用Mock响应

1. 创建API，路径设置为：`/api/users`
2. 在"Mock响应"标签页输入：
   ```json
   {
     "code": 0,
     "data": [
       {"id": 1, "name": "张三"},
       {"id": 2, "name": "李四"}
     ]
   }
   ```
3. 点击"确定"保存
4. 在接口测试中选择该API
5. 点击"发送测试"
6. 返回Mock响应数据（不发送真实请求）

---

## 最佳实践

### 1. 环境配置建议

- **开发环境**：本地开发服务器
- **测试环境**：测试服务器
- **生产环境**：生产服务器

### 2. Mock响应建议

- **格式统一**：使用统一的响应格式（如 `{code, data, message}`）
- **数据真实**：Mock数据尽量接近真实数据结构
- **场景覆盖**：为不同场景准备不同的Mock数据

### 3. 搜索建议

- 使用有意义的API名称，便于搜索
- 添加详细的描述信息
- 使用统一的命名规范

---

## 技术实现

### 环境配置存储
- 存储在 `localStorage` 的 `api_environments` 键
- 当前环境存储在 `api_current_environment` 键

### 搜索实现
- 使用 `useMemo` 优化搜索性能
- 支持多字段模糊匹配
- 实时过滤，无需点击搜索按钮

### JSON格式化
- 使用 `JSON.parse` 和 `JSON.stringify` 实现
- 自动处理格式错误
- 保持原始数据不变

---

## 更新日志

**2025-12-16**
- ✅ 新增环境配置功能
- ✅ 新增API搜索功能
- ✅ 新增JSON格式化功能
- ✅ 增强Mock响应说明
- ✅ 优化测试结果显示
- ✅ 添加复制功能

---

**最后更新**: 2025-12-16

