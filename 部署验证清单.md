# 部署验证清单

## ✅ 构建检查

### 后端构建
- [ ] 运行 `cd backend && npm run build`
- [ ] 确认 `backend/dist/index.js` 文件存在
- [ ] 确认没有构建错误

### 前端构建
- [ ] 运行 `cd frontend && npm run build`
- [ ] 确认 `frontend/dist` 目录存在
- [ ] 确认 `frontend/dist/index.html` 文件存在
- [ ] 确认没有构建错误

## ✅ 数据库检查

- [ ] 运行 `cd backend && npx prisma generate`
- [ ] 确认 `backend/prisma/dev.db` 文件存在（或可以创建）
- [ ] 如果数据库不存在，运行 `cd backend && npx prisma migrate dev --name init`

## ✅ 服务启动检查

### 后端服务
1. 运行 `cd backend && npm start`
2. 检查输出：
   - ✅ 应该看到：`Server is running on http://0.0.0.0:3001`
   - ✅ 应该看到：`数据库连接成功`
3. 测试健康检查：
   - 在浏览器访问：`http://localhost:3001/api/health`
   - 应该返回：`{"status":"ok","message":"Low-code platform API is running"}`

### 前端服务
1. 运行 `cd frontend && npm run preview -- --host 0.0.0.0`
2. 检查输出：
   - ✅ 应该看到类似：`Local: http://localhost:4173/`
   - ✅ 应该看到类似：`Network: http://192.168.x.x:4173/`
3. 在浏览器访问：`http://localhost:4173`
   - ✅ 应该能看到应用界面

## ✅ 网络访问检查

### 获取本机 IP 地址
- Windows: 运行 `ipconfig`，查找 IPv4 地址
- Linux/Mac: 运行 `ifconfig` 或 `ip addr`

### 测试外部访问
1. 确保前端和后端都在运行
2. 在同一网络的其他设备上：
   - 访问前端：`http://<本机IP>:4173`
   - 测试后端：`http://<本机IP>:3001/api/health`
3. 如果无法访问，检查：
   - ✅ Windows 防火墙设置
   - ✅ 端口是否被占用
   - ✅ 设备是否在同一网络

## ✅ 防火墙配置

### Windows 防火墙
1. 打开"Windows 安全中心" → "防火墙和网络保护"
2. 点击"高级设置"
3. 入站规则 → 新建规则 → 端口
4. 添加规则：
   - 端口：`3001`（TCP）- 后端
   - 端口：`4173`（TCP）- 前端预览
5. 选择"允许连接"
6. 完成规则创建

## ✅ 快速测试命令

```bash
# 1. 测试构建
cd backend && npm run build && cd ../frontend && npm run build

# 2. 启动后端（新终端窗口）
cd backend && npm start

# 3. 启动前端（新终端窗口）
cd frontend && npm run preview -- --host 0.0.0.0

# 4. 测试后端
curl http://localhost:3001/api/health

# 5. 查看本机 IP（Windows）
ipconfig | findstr IPv4
```

## ✅ 常见问题排查

### 问题1：端口被占用
**解决**：
```bash
# Windows 查找占用端口的进程
netstat -ano | findstr :3001
netstat -ano | findstr :4173

# 终止进程（替换 PID 为实际进程ID）
taskkill /PID <PID> /F
```

### 问题2：数据库连接失败
**解决**：
```bash
cd backend
npx prisma generate
npx prisma migrate dev --name init
```

### 问题3：前端无法连接后端
**检查**：
1. 确认后端服务正在运行
2. 确认后端监听在 `0.0.0.0:3001`
3. 检查前端环境变量 `VITE_API_BASE_URL`

### 问题4：其他设备无法访问
**检查**：
1. 确认服务监听在 `0.0.0.0` 而不是 `localhost`
2. 检查防火墙设置
3. 确认设备在同一网络
4. 尝试 ping 本机 IP 地址

## ✅ 部署成功标志

当以下所有项都完成时，部署成功：

- ✅ 后端服务运行在 `http://0.0.0.0:3001`
- ✅ 前端服务运行在 `http://0.0.0.0:4173`
- ✅ 本机可以访问 `http://localhost:4173`
- ✅ 本机可以访问 `http://localhost:3001/api/health`
- ✅ 其他设备可以访问 `http://<本机IP>:4173`
- ✅ 前端可以正常调用后端 API

