/**
 * 自动化回归测试脚本
 * 使用Playwright进行端到端测试
 * 
 * 使用方法：
 * 1. 确保服务已启动（前端3000，后端3001）
 * 2. 运行：node tests/自动化回归测试.js
 */

// 注意：这是一个测试计划文档，实际执行需要使用Playwright测试框架
// 以下是测试用例的详细步骤

const testCases = {
  // 1. 首页和导航测试
  homePage: {
    name: '首页和导航测试',
    steps: [
      '访问 http://localhost:3000',
      '验证页面标题包含"低代码开发平台"',
      '验证所有功能卡片显示（6个卡片）',
      '点击"可视化编辑器"卡片，验证跳转到 /editor',
      '返回首页，点击"项目管理"卡片，验证跳转到 /projects',
      '返回首页，点击"数据模型"卡片，验证跳转到 /data-models',
      '返回首页，点击"工作流"卡片，验证跳转到 /workflows',
      '返回首页，点击"表单设计器"卡片，验证跳转到 /form-designer',
      '返回首页，点击"API设计器"卡片，验证跳转到 /api-designer',
      '测试侧边栏导航菜单',
    ],
  },

  // 2. 可视化编辑器测试
  editor: {
    name: '可视化编辑器测试',
    steps: [
      '访问 /editor',
      '验证组件面板显示（7种组件）',
      '验证画布区域显示',
      '验证属性面板显示',
      '验证组件树显示',
      '从组件面板拖拽"按钮"组件到画布',
      '验证按钮组件在画布中显示',
      '验证组件树中显示新组件',
      '点击画布中的按钮组件，验证选中状态',
      '在属性面板修改按钮文本为"测试按钮"',
      '验证画布中按钮文本更新',
      '从组件面板拖拽"输入框"组件到画布',
      '从组件面板拖拽"表格"组件到画布',
      '验证组件树显示3个组件',
      '点击组件树中的组件，验证选中',
      '选中组件，点击删除按钮，验证组件被删除',
      '测试撤销功能（Ctrl+Z）',
      '测试重做功能（Ctrl+Y）',
      '测试清空画布功能',
      '打开AI助手面板',
      '打开预览面板',
      '打开事件绑定面板',
      '打开数据绑定面板',
    ],
  },

  // 3. 项目管理测试
  projects: {
    name: '项目管理测试',
    steps: [
      '访问 /projects',
      '验证项目列表显示（可能为空）',
      '点击"创建项目"按钮',
      '填写项目名称："测试项目"',
      '填写项目描述："这是一个测试项目"',
      '提交表单',
      '验证新项目出现在列表中',
      '点击项目列表中的项目，验证详情显示',
      '点击"编辑"按钮',
      '修改项目名称',
      '保存修改',
      '验证项目名称已更新',
      '点击"删除"按钮',
      '确认删除',
      '验证项目从列表中移除',
    ],
  },

  // 4. 数据模型管理测试
  dataModels: {
    name: '数据模型管理测试',
    steps: [
      '访问 /data-models',
      '验证数据模型列表显示',
      '点击"创建数据模型"按钮',
      '填写模型名称："用户模型"',
      '添加字段：name（字符串）',
      '添加字段：age（数字）',
      '添加字段：email（字符串）',
      '保存数据模型',
      '验证新模型出现在列表中',
      '点击模型，查看详情',
      '添加新字段',
      '编辑字段属性',
      '删除字段',
      '删除数据模型',
      '验证模型从列表中移除',
    ],
  },

  // 5. API设计器测试
  apiDesigner: {
    name: 'API设计器测试',
    steps: [
      '访问 /api-designer',
      '验证API列表显示',
      '点击"创建API"按钮',
      '填写API名称："获取用户列表"',
      '选择HTTP方法：GET',
      '填写API路径：/api/users',
      '添加请求参数',
      '设置Mock响应：{"users": []}',
      '保存API',
      '验证新API出现在列表中',
      '点击"测试"按钮',
      '验证测试结果显示',
      '编辑API信息',
      '保存修改',
      '删除API',
      '验证API从列表中移除',
    ],
  },

  // 6. 工作流引擎测试
  workflows: {
    name: '工作流引擎测试',
    steps: [
      '访问 /workflows',
      '验证工作流列表显示',
      '点击"创建工作流"按钮',
      '填写工作流名称："审批流程"',
      '添加开始节点',
      '添加任务节点',
      '添加条件节点',
      '添加审批节点',
      '添加结束节点',
      '连接节点（开始->任务->条件->审批->结束）',
      '配置节点属性',
      '保存工作流',
      '验证新工作流出现在列表中',
      '点击"执行"按钮',
      '验证工作流执行',
      '查看执行历史',
      '查看工作流实例',
      '删除工作流',
    ],
  },

  // 7. 表单设计器测试
  formDesigner: {
    name: '表单设计器测试',
    steps: [
      '访问 /form-designer',
      '验证表单字段列表显示',
      '点击"添加字段"按钮',
      '选择字段类型：输入框',
      '配置字段属性（名称、标签、验证规则）',
      '添加更多字段（选择器、日期选择等）',
      '预览表单',
      '验证表单显示正确',
      '测试表单验证',
      '编辑字段',
      '删除字段',
    ],
  },

  // 8. AI功能测试
  aiAssistant: {
    name: 'AI助手功能测试',
    steps: [
      '在编辑器中打开AI助手面板',
      '输入自然语言："创建一个登录表单"',
      '点击生成按钮',
      '验证AI响应',
      '验证生成的代码',
      '点击应用到画布',
      '验证组件被添加到画布',
      '测试组件推荐功能',
      '测试代码优化功能',
    ],
  },

  // 9. 错误处理测试
  errorHandling: {
    name: '错误处理测试',
    steps: [
      '测试网络错误处理',
      '测试表单验证错误',
      '测试空数据状态',
      '测试Loading状态显示',
      '测试错误边界',
    ],
  },
};

// 导出测试用例
if (typeof module !== 'undefined' && module.exports) {
  module.exports = testCases;
}

console.log('回归测试计划已加载');
console.log(`共 ${Object.keys(testCases).length} 个测试模块`);
Object.keys(testCases).forEach((key) => {
  console.log(`- ${testCases[key].name}: ${testCases[key].steps.length} 个测试步骤`);
});

