# 🎉 部署成功指南

恭喜！项目已经可以正常部署了。以下是部署说明和验证步骤。

## ✅ 已完成的配置

### 1. 构建配置
- ✅ 后端构建配置正确
- ✅ 前端构建配置正确
- ✅ TypeScript 类型错误已全部修复
- ✅ 所有依赖已正确配置

### 2. 服务器配置
- ✅ 后端监听 `0.0.0.0:3001`（支持外部访问）
- ✅ 前端预览服务器监听 `0.0.0.0:4173`（支持外部访问）
- ✅ CORS 已正确配置
- ✅ API 代理配置正确

### 3. 数据库配置
- ✅ Prisma 配置正确
- ✅ 数据库初始化脚本已准备

## 🚀 部署方法

### 方法一：一键部署（推荐）

直接运行 `一键部署.bat`：
```bash
一键部署.bat
```

这个脚本会：
1. 自动构建后端
2. 自动构建前端
3. 检查并初始化数据库
4. 启动后端服务（端口 3001）
5. 启动前端预览服务（端口 4173）

### 方法二：手动部署

#### 步骤 1：构建项目
```bash
# 构建后端
cd backend
npm run build
cd ..

# 构建前端
cd frontend
npm run build
cd ..
```

#### 步骤 2：初始化数据库（首次部署）
```bash
cd backend
npx prisma generate
npx prisma migrate dev --name init
cd ..
```

#### 步骤 3：启动服务

**终端 1 - 启动后端：**
```bash
cd backend
npm start
```

**终端 2 - 启动前端：**
```bash
cd frontend
npm run preview -- --host 0.0.0.0
```

### 方法三：使用生产环境脚本

运行 `启动生产环境.bat`，然后选择：
- 选项 1：仅启动后端
- 选项 2：启动后端 + 前端预览（推荐）
- 选项 3：使用 PM2 管理（需要安装 PM2）

## 📍 访问地址

部署成功后，可以通过以下地址访问：

### 本地访问
- **前端应用**：`http://localhost:4173`
- **后端 API**：`http://localhost:3001`
- **健康检查**：`http://localhost:3001/api/health`

### 网络访问（同一局域网）

1. **获取本机 IP 地址**
   ```bash
   ipconfig  # Windows
   ```
   查找 IPv4 地址，例如：`192.168.1.100`

2. **访问地址**
   - **前端应用**：`http://192.168.1.100:4173`
   - **后端 API**：`http://192.168.1.100:3001`
   - **健康检查**：`http://192.168.1.100:3001/api/health`

## ✅ 部署验证

### 1. 检查服务是否启动

**后端服务**应该看到：
```
Server is running on http://0.0.0.0:3001
✅ 数据库连接成功
```

**前端服务**应该看到：
```
  ➜  Local:   http://localhost:4173/
  ➜  Network: http://192.168.x.x:4173/
```

### 2. 测试后端 API

在浏览器访问或使用 curl：
```bash
curl http://localhost:3001/api/health
```

应该返回：
```json
{"status":"ok","message":"Low-code platform API is running"}
```

### 3. 测试前端应用

在浏览器访问：`http://localhost:4173`

应该能看到低代码平台的应用界面。

### 4. 测试网络访问

在同一网络的其他设备（手机、平板、其他电脑）访问：
- `http://<本机IP>:4173`

应该能看到应用界面。

## 🔧 常见问题解决

### 问题 1：端口被占用

**错误信息**：`Error: listen EADDRINUSE: address already in use :::3001`

**解决方法**：
```bash
# Windows - 查找占用端口的进程
netstat -ano | findstr :3001
netstat -ano | findstr :4173

# 终止进程（替换 PID 为实际进程ID）
taskkill /PID <PID> /F
```

### 问题 2：数据库连接失败

**错误信息**：`⚠️ 数据库连接失败`

**解决方法**：
```bash
cd backend
npx prisma generate
npx prisma migrate dev --name init
```

### 问题 3：其他设备无法访问

**可能原因**：
1. 防火墙阻止了端口
2. 服务没有监听在 `0.0.0.0`
3. 设备不在同一网络

**解决方法**：

1. **配置 Windows 防火墙**
   - 打开"Windows 安全中心" → "防火墙和网络保护"
   - 点击"高级设置"
   - 入站规则 → 新建规则 → 端口
   - 添加端口 `3001` 和 `4173`
   - 选择"允许连接"

2. **检查服务配置**
   - 确认后端监听在 `0.0.0.0:3001`
   - 确认前端使用 `--host 0.0.0.0` 参数

3. **检查网络**
   - 确保设备在同一 WiFi 网络
   - 尝试 ping 本机 IP 地址

### 问题 4：前端无法连接后端

**可能原因**：
1. 后端服务未启动
2. API 地址配置错误

**解决方法**：
1. 确认后端服务正在运行
2. 检查浏览器控制台的错误信息
3. 检查 `frontend/.env.production` 或环境变量配置

## 📝 部署检查清单

使用以下清单确保部署成功：

- [ ] 后端构建成功（`backend/dist/index.js` 存在）
- [ ] 前端构建成功（`frontend/dist/index.html` 存在）
- [ ] 数据库已初始化（`backend/prisma/dev.db` 存在）
- [ ] 后端服务启动成功（看到启动消息）
- [ ] 前端服务启动成功（看到启动消息）
- [ ] 可以访问 `http://localhost:4173`
- [ ] 可以访问 `http://localhost:3001/api/health`
- [ ] 浏览器控制台没有错误
- [ ] 网络访问正常（其他设备可以访问）

## 🎯 下一步

部署成功后，您可以：

1. **自定义配置**
   - 修改 `backend/.env` 配置后端参数
   - 修改 `frontend/.env.production` 配置前端参数

2. **使用 Docker 部署**
   ```bash
   docker-compose up -d
   ```

3. **配置域名和 HTTPS**
   - 使用 Nginx 作为反向代理
   - 配置 SSL 证书

4. **监控和日志**
   - 使用 PM2 管理进程
   - 配置日志收集

## 📚 相关文档

- [部署说明.md](./部署说明.md) - 详细部署文档
- [快速部署指南.md](./快速部署指南.md) - 快速开始指南
- [部署验证清单.md](./部署验证清单.md) - 验证清单

---

**祝您部署顺利！** 🎉

