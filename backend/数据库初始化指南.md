# 数据库初始化指南

## 快速开始

由于Prisma CLI版本兼容性问题，请按照以下步骤手动初始化数据库：

### 步骤1：安装依赖

```bash
cd backend
npm install prisma@5.19.1 @prisma/client@5.19.1 better-sqlite3 --save-exact
```

### 步骤2：生成Prisma Client

```bash
npx prisma generate
```

### 步骤3：创建数据库迁移

```bash
npx prisma migrate dev --name init
```

这将：
- 创建SQLite数据库文件：`prisma/dev.db`
- 创建所有表结构
- 生成迁移文件

### 步骤4：验证

启动后端服务器：

```bash
npm run dev
```

如果看到 "✅ 数据库连接成功"，说明数据库已正确配置。

## 使用Prisma Studio查看数据

```bash
npx prisma studio
```

这将打开浏览器界面（通常是 http://localhost:5555），可以在其中查看和编辑数据库内容。

## 故障排查

### 问题1：找不到 @prisma/client

**解决：** 运行 `npx prisma generate`

### 问题2：数据库文件不存在

**解决：** 运行 `npx prisma migrate dev --name init`

### 问题3：Prisma CLI版本错误

**解决：** 使用本地安装的Prisma版本：
```bash
npm install prisma@5.19.1 --save-dev
./node_modules/.bin/prisma generate
```

## 数据库文件位置

- SQLite数据库：`backend/prisma/dev.db`
- 迁移文件：`backend/prisma/migrations/`

## 生产环境

生产环境建议使用PostgreSQL：

1. 修改 `prisma/schema.prisma`：
   ```prisma
   datasource db {
     provider = "postgresql"
     url      = env("DATABASE_URL")
   }
   ```

2. 设置环境变量：
   ```
   DATABASE_URL="postgresql://user:password@localhost:5432/dbname"
   ```

3. 运行迁移：
   ```bash
   npx prisma migrate deploy
   ```

