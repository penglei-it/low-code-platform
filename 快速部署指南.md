# 快速部署指南

## 🚀 最快部署方式（3 步完成）

### 方式一：本地网络部署（推荐新手）

#### Windows 系统

1. **双击运行脚本**
   ```
   启动生产环境.bat
   ```

2. **查看本机 IP**
   ```bash
   ipconfig
   ```
   找到 `IPv4 地址`，例如：`192.168.1.100`

3. **访问应用**
   - 在浏览器打开：`http://192.168.1.100:4173`
   - 同一局域网的其他设备也可以访问

#### Linux/Mac 系统

1. **运行脚本**
   ```bash
   chmod +x 启动生产环境.sh
   ./启动生产环境.sh
   ```

2. **查看本机 IP**
   ```bash
   ifconfig  # 或 ip addr
   ```

3. **访问应用**
   - 前端：`http://<你的IP>:4173`
   - 后端：`http://<你的IP>:3001`

---

### 方式二：Docker 部署（推荐生产环境）

**前提条件**：已安装 Docker 和 Docker Compose

1. **一键启动**
   ```bash
   docker-compose up -d
   ```

2. **查看状态**
   ```bash
   docker-compose ps
   ```

3. **访问应用**
   - 前端：`http://<服务器IP>`（端口 80）
   - 后端：`http://<服务器IP>:3001`

**停止服务**
```bash
docker-compose down
```

---

## ⚙️ 配置说明

### 首次部署需要初始化数据库

如果数据库不存在，脚本会自动初始化。也可以手动运行：

```bash
cd backend
npx prisma generate
npx prisma migrate dev --name init
```

### 修改端口

**后端端口**（默认 3001）：
- 修改 `backend/src/index.ts` 中的 `PORT` 变量
- 或设置环境变量：`PORT=3002`

**前端端口**（默认 4173，预览模式）：
- 修改 `frontend/package.json` 中的预览端口
- 或在启动时指定：`npm run preview -- --port 4174`

### 配置 API 地址

如果前端和后端不在同一台机器或端口，需要配置前端环境变量：

创建 `frontend/.env.production`：
```env
VITE_API_BASE_URL=http://后端IP:后端端口/api
```

---

## 🔥 防火墙设置

### Windows

1. 打开"Windows 安全中心" -> "防火墙和网络保护"
2. 点击"高级设置"
3. 入站规则 -> 新建规则 -> 端口
4. 添加端口：`3001` 和 `4173`
5. 允许连接

### Linux

```bash
# Ubuntu/Debian
sudo ufw allow 3001/tcp
sudo ufw allow 4173/tcp

# CentOS
sudo firewall-cmd --permanent --add-port=3001/tcp
sudo firewall-cmd --permanent --add-port=4173/tcp
sudo firewall-cmd --reload
```

---

## 📱 让手机/平板访问

1. **确保设备在同一 WiFi 网络**
2. **查找电脑 IP 地址**
   - Windows: `ipconfig` 查看 IPv4
   - Mac/Linux: `ifconfig` 或 `ip addr`
3. **在手机浏览器访问**
   - `http://<电脑IP>:4173`

---

## 🐛 常见问题

### ❌ 无法访问？

1. **检查服务是否运行**
   - Windows: 查看任务管理器
   - Linux: `ps aux | grep node`

2. **检查防火墙**
   - 确认端口未被阻止

3. **检查 IP 地址**
   - 确保使用正确的 IP 地址

### ❌ 前端无法连接后端？

1. **检查后端是否运行**
   - 访问：`http://<IP>:3001/api/health`

2. **检查 API 配置**
   - 查看 `frontend/.env.production`
   - 确认 `VITE_API_BASE_URL` 正确

### ❌ 数据库错误？

1. **初始化数据库**
   ```bash
   cd backend
   npx prisma generate
   npx prisma migrate dev --name init
   ```

2. **检查数据库文件权限**

---

## 📚 详细文档

更多详细信息请查看：[部署说明.md](./部署说明.md)

---

## 💡 提示

- **开发环境**：使用 `启动项目.bat` 或 `npm run dev`
- **生产环境**：使用 `启动生产环境.bat` 或 Docker
- **推荐使用 PM2**：保持服务持续运行（脚本选项 3）

